{% extends "3columns.html" %}

{% block title %}{% endblock %}

{% block facebooktags %}
<meta property="og:title" content="Pagan ${{ article.price }} por {{ article.title}}"/>
<meta property="og:type" content="Ecommerce"/>
<meta property="og:url" content="http://www.howmuch.do{{ article.get_url }}"/>
<meta property="og:image" content=""/>
<meta property="og:site_name" content="howmuch"/>
<meta property="og:description"
    content="{{ article.description|truncatechars:100}}"/>
{% endblock %}

{% block media %}
<link rel="stylesheet" href="{{ MEDIA_URL }}css/glisse.css" />
<script src="{{ MEDIA_URL }}js/glisse.js"></script>
<script>
$(function () {
    $('.pics').glisse({
        changeSpeed: 550,
        speed: 500,
        effect:'bounce',
        fullscreen: true,
    });
});
</script>
<script type="text/javascript">

$(document).on('ready', function(){

	pic_count= {{ article.pictures.all.count }};
	var pic_ids= new Array();
	{% for p in article.pictures.all %}
		pic_ids[{{ forloop.counter0 }}]={{ p.pk }};
	{% endfor %}

	$('#comments-form').submit(function(e){
		e.preventDefault();
		$.post('/comments/post/{{ article.pk }}/', 
			$('#comments-form').serialize(),
			function(data){
				$('.comments-area').append(data);
				$('#comments-form')[0].reset();
			});
	});

	$('.unfollow').click(function(e){
		e.preventDefault()
		$.getJSON('/profile/e/follow/{{ article.pk }}', function(json){
		});
	});

	$('.follow').click(function(e){
		e.preventDefault();
		$.getJSON('/profile/e/unfollow/{{ article.pk }}', function(json){
		});
	});

	$('.delete_pic').click(function(e){
		if (pic_count == 1){
			$('#uniquepicerrordiv').show();
		}
		else {
			e.preventDefault();
			$.getJSON('/article/deletepicture/{{ article.pk }}/'+this.id, function(json){
			});
			$('#div'+this.id).hide();
			
			if ($('#articledisplayimage').attr("src") == $('#pic_'+this.id).attr("src").split("?")[0]){
            	$('#articledisplayimage').attr("src", $('#pic_'+pic_ids[pic_ids.length-pic_count+1]).attr("src").split("?")[0]);
            	$('#articledisplayimage').fadeIn();
			}
			pic_count--;
		}
	});

	$('#uniquepicerrorbutton').click(function(e){
		$('#uniquepicerrordiv').hide();
	});

	$('#comments-form').submit(function(e){
		e.preventDefault();
		$.post('/comments/post/{{ article.pk }}/', 
			$('#comments-form').serialize(),
			function(data){
				$('.comments-area').append(data);
				$('#comments-form')[0].reset();
			});
	});
});
</script>
{% endblock %}

{% block search-bar %}
	{% include "search.html" %}
{% endblock %}

{% block section1 %}
	{% include "categories.html" %}
{% endblock %}

{% block section2 %}
<section class="wrapper-div">
	<article>
	{% if new_post %}
	<div class="alert alert-success">
    	<button type="button" class="close" data-dismiss="alert">&times;</button>
    	<h4>Felicidades!</h4>
    	Acabas de Publicar correctamente tu Compra
    </div>
	{% endif %}
	{% if article.owner == user %}
    <div class="alert alert-block">
    	<button type="button" class="close" data-dismiss="alert">&times;</button>
    	Esta Es Tu Publicaci贸n <a href="{{ article.get_url }}/edit">Editar</a>
    </div>
	{% endif %}

	{% if not article.is_active %}
	<div class="alert alert-error">
		<button type="button" class="close" data-dismiss="alert">&times;</button>
    	Esta Publicaci贸n Ha Finalizado <a href="/article/post">Publicar una Compra</a>
    </div>
	{% endif %}
	</article>

	<article class="margin10">
		<center>
			Publicado <b>hace {{ article.date|timesince }}</b> por <a href="/profile/{{ article.owner }}">{{ article.owner }}</a> 
		</center>
	</article>

	<article class="row-fluid">
		<div class="thumbnail span4">
    		<img id="articledisplayimage" src="{{ article.get_first_picture_url }}" alt="">
    	</div>
   
	
		<div class="span8">
			<div class="text-center">
				<h2>COMPRO {{ article.title }}</h2>
			</div>
			<div class="background2 text-center">
				<h4>{{ article.state }}</h4>
			</div>
			<div class="text-center">
				<a class="btn btn-primary btn-large" href="/article/offer/{{ article.pk }}">Venderlo</a>
				<!-- 
				<a id="btn-follow" class="btn btn-large btn-success unfollow" href="#">Seguir</a>
				<a id="btn-follow" class="btn btn-large btn-success follow" href="#">Siguiendo</a>
				 -->
			</div>
			<div class="text-center background4 font1">
				<h2>$ {{ article.price }}</h2>
			</div>
		</div>
	</article>

	<article class="margin5">
		<legend>Quiero algo parecido a</legend>
		<div id="uniquepicerrordiv" class="alert alert-error" style="display:none;">
			<button id="uniquepicerrorbutton" type="button" class="close">&times;</button>
    		No puedes eliminar la unica imagen del articulo
    	</div>
		<div class="text-center span12">
		{% for picture in article.pictures.all %}
			<div id="div{{ picture.pk }}" class="thumbnail span3">
				<img id="pic_{{ picture.pk }}" class="pics" src="{{ picture.picture.url }}" data-glisse-big="{{ picture.picture.url }}" rel="group1"/>
				{% if user.is_authenticated and user == article.owner %}
					<a id={{ picture.pk }} class="btn btn-mini delete_pic" href="#"><i class="icon-remove"></i></a>
				{% endif %}
			</div>
		{% endfor%}
		</div>
	</article>

	<article class="margin10">
		<center>
			<div class="fb-like" data-href="http://www.howmuch.do{{ article.get_url }}" data-send="true" data-layout="button_count" data-width="450" data-show-faces="true" data-font="arial">
			</div>
		</center>
	</article>

	<article>
		<legend>Etiquetas</legend>
		<center>
		{% for tag in article.tags.all %}
			<a class="btn btn-info" href="#">{{ tag }}</a>
		{% endfor %}
		</center>
	</article>

	<article>
		<legend>Descripcion de la compra</legend>
		<p>{{ article.description }}</p>
	</article>
</section>

<!-- Comments Area -->
<section class="wrapper-div">
	<legend>Dudas del Articulo</legend>
	<div class="comments-area">
		{% for comment in article.comments.all %}
			<div class="wrapper-div row">
				<div class="span1 thumbnail">
					<img src="{{ comment.owner.profile.get_profile_picture }}">
				</div>
				<div class="span9">
					<p>	
						{{ comment.comment }}
					</p>
				</div>
				<div>
					<b>
						hace {{ comment.get_timestamp }}
					</b>
				</div>
			</div>
		{% endfor %}
	</div>
	{% if user.is_authenticated %}
	<div>
		<form id="comments-form" method="POST" enctype="multipart/form-data">{% csrf_token %}
			<input class="span12" type="text" id="comment" name="comment" placeholder="Escribe una duda...">
		</form>
	</div>
	{% else %}
	<div>
		<p>
			<span>Para poder comentar debes iniciar sesi贸n</span>
			<a href="/login/">Iniciar Sesi贸n</a>
		</p>
	</div>
	{% endif %}
	<div class="text-center">
		<a class="btn btn-primary btn-large" href="/article/offer/{{ article.pk }}">Venderlo</a>
	</div>
</section>
{% endblock %}

{% block section3 %}
	{% include "howtodo.html" %}
{% endblock %}




